<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1m Grid + Headers (Aligned)</title>
<style>
  /* 1m size + canvas size - Enhanced responsive scaling */
  :root { 
    --m: min(2.5vw, 2.5vh, 36px); 
    --cols: 41; 
    --rows: 20; 
    --max-width: calc(var(--cols) * var(--m));
    --max-height: calc(var(--rows) * var(--m));
  }
  
  /* Responsive breakpoints with proportional scaling */
  @media (max-width: 1600px) { :root { --m: min(2.2vw, 2.2vh, 32px); } }
  @media (max-width: 1200px) { :root { --m: min(2.0vw, 2.0vh, 28px); } }
  @media (max-width: 900px)  { :root { --m: min(1.8vw, 1.8vh, 24px); } }
  @media (max-width: 600px)  { :root { --m: min(1.6vw, 1.6vh, 20px); } }
  @media (max-width: 480px)  { :root { --m: min(1.4vw, 1.4vh, 16px); } }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    min-height: 100vh; display: flex; align-items: center; justify-content: center;
    background: #0f172a; color: #e2e8f0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    padding: min(2vw, 20px); margin: 0; overflow: auto;
  }

  .frame{
    display: inline-grid;
    grid-template-columns: auto repeat(var(--cols), var(--m));
    grid-template-rows: auto repeat(var(--rows), var(--m));
    background: #fff; border: 1px solid #cbd5e1;
    box-shadow: 0 10px 30px rgba(2,8,23,.25);
    position: relative;
    max-width: 100vw; max-height: 100vh;
    width: fit-content; height: fit-content;
  }

  .col-label{ 
    grid-row: 1; text-align: center; color: #0f172a; border-left: 1px solid #e5e7eb;
    font-size: max(8px, min(0.8em, calc(var(--m) * 0.3))); padding: 2px 4px;
  }
  .row-label{ 
    grid-column: 1; text-align: right; color: #0f172a; border-top: 1px solid #e5e7eb;
    font-size: max(8px, min(0.8em, calc(var(--m) * 0.3))); padding: 0 6px 0 4px;
  }

  .bg{ grid-column: 2 / span var(--cols); grid-row: 2 / span var(--rows); position: relative; }
  .bg::before{
    content: ""; position: absolute; inset: 0; pointer-events: none;
    /* Grid background removed - keeping clean floor map */
    background: transparent;
  }

  .grid{
    grid-column: 2 / span var(--cols);
    grid-row: 2 / span var(--rows);
    display: grid;
    grid-template-columns: repeat(var(--cols), var(--m));
    grid-template-rows: repeat(var(--rows), var(--m));
    position: relative; z-index: 1;
  }

  /* Individual tiles for donation tracking */
  .tile {
    border: none; /* Remove grid lines for clean floor map */
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
    background: transparent;
  }
  
  .tile:hover {
    background: rgba(59, 130, 246, 0.2);
    border-color: #3b82f6;
    z-index: 10;
  }
  
  /* Donation states */
  .tile.available { background: rgba(34, 197, 94, 0.1); }
  .tile.promised { background: rgba(251, 191, 36, 0.4); }
  .tile.paid { background: rgba(34, 197, 94, 0.6); }
  
  .tile.promised:hover { background: rgba(251, 191, 36, 0.6); }
  .tile.paid:hover { background: rgba(34, 197, 94, 0.8); }

  .shape{ 
    display:flex; align-items:center; justify-content:center; 
    font-weight:800; color:#fff; opacity:.78;
    font-size: max(12px, min(1.2em, calc(var(--m) * 0.4)));
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.28); 
    user-select: none; 
  }
  .A{ background:#b91c1c } .B{ background:#ea580c } .C{ background:#ca8a04 }
  .D{ background:#2563eb } .E{ background:#16a34a } .F{ background:#7c3aed } .G{ background:#0891b2 }

  /* Totals: A=108, B=9, C=16, D=120, E=120, F=20, G=120 => 513 */

  /* A already ends at row 16 */
  .A{ grid-column:  1 / span  9; grid-row:  5 / span 12; }

  .B{ grid-column:  1 / span  3; grid-row: 17 / span  3; }

  /* C base aligned to row 16 (moved down, same height) */
  .C{ grid-column: 10 / span  2; grid-row:  9 / span  8; }

  /* E base aligned to row 16 (moved up, same height) */
  .E{ grid-column: 12 / span 12; grid-row:  7 / span 10; }

  /* D base aligned to row 16 (moved down, same height) */
  .D{ grid-column: 24 / span 10; grid-row:  5 / span 12; }

  .G{ grid-column: 34 / span  8; grid-row:  6 / span 15; }

  /* F previously set to AH column, rows 2–5 */
  .F{ grid-column: 34 / span  5; grid-row:  2 / span  4; }

  .hud{
    position: absolute; right: 8px; top: 8px;
    background: #065f46; color: #fff; 
    font-size: max(10px, min(0.9em, calc(var(--m) * 0.35)));
    padding: 8px 10px; border-radius: 6px; z-index: 2;
    box-shadow: 0 6px 20px rgba(2,8,23,.25);
    max-width: calc(100vw - 20px);
  }
  .hud.error{ background:#991b1b; }
  .hud b{ font-weight:800; }

  /* Legend for donation states */
  .legend {
    position: absolute; left: 8px; top: 8px;
    background: rgba(255, 255, 255, 0.95); color: #0f172a;
    font-size: max(9px, min(0.8em, calc(var(--m) * 0.3)));
    padding: 8px 10px; border-radius: 6px; z-index: 2;
    box-shadow: 0 6px 20px rgba(2,8,23,.25);
    border: 1px solid #e5e7eb;
  }
  
  .legend-item {
    display: flex; align-items: center; margin: 2px 0;
  }
  
  .legend-color {
    width: 12px; height: 12px; border-radius: 2px;
    margin-right: 6px; border: 1px solid rgba(0,0,0,0.2);
  }
  
  .legend-available { background: rgba(34, 197, 94, 0.1); }
  .legend-promised { background: rgba(251, 191, 36, 0.4); }
  .legend-paid { background: rgba(34, 197, 94, 0.6); }
</style>
</head>
<body>
  <div class="frame" id="frame">
    <div></div>
    <div id="col-letters"></div>
    <div id="rows"></div>
    <div class="bg"></div>

    <div class="grid" id="grid">
      <div class="shape A">A</div>
      <div class="shape B">B</div>
      <div class="shape C">C</div>
      <div class="shape D">D</div>
      <div class="shape E">E</div>
      <div class="shape F">F</div>
      <div class="shape G">G</div>
    </div>

    <div class="hud" id="hud">checking…</div>
    
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color legend-available"></div>
        <span>Available</span>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-promised"></div>
        <span>Promised</span>
      </div>
      <div class="legend-item">
        <div class="legend-color legend-paid"></div>
        <span>Paid</span>
      </div>
    </div>
  </div>

<script>
const cols = +getComputedStyle(document.documentElement).getPropertyValue('--cols').trim();
const rows = +getComputedStyle(document.documentElement).getPropertyValue('--rows').trim();
const frame = document.getElementById('frame');

function colName(n){ let s="",x=n; while(x>0){x--; s=String.fromCharCode(65+(x%26))+s; x=Math.floor(x/26);} return s; }
for(let c=1;c<=cols;c++){ const d=document.createElement('div'); d.className='col-label'; d.style.gridColumn=(c+1); d.textContent=colName(c); frame.appendChild(d); }
for(let r=1;r<=rows;r++){ const d=document.createElement('div'); d.className='row-label'; d.style.gridRow=(r+1); d.textContent=r; frame.appendChild(d); }

// Donation tracking system
const donationData = {}; // Store tile states: 'available', 'promised', 'paid'
let selectedTile = null;

// Generate individual clickable tiles
function generateTiles() {
  const grid = document.getElementById('grid');
  
  for (let row = 1; row <= rows; row++) {
    for (let col = 1; col <= cols; col++) {
      const tile = document.createElement('div');
      const tileId = `${colName(col)}${row}`;
      
      tile.className = 'tile available';
      tile.dataset.tileId = tileId;
      tile.dataset.col = col;
      tile.dataset.row = row;
      tile.title = `Tile ${tileId} - Click to change donation status`;
      tile.style.gridColumn = col;
      tile.style.gridRow = row;
      
      // Initialize as available
      donationData[tileId] = 'available';
      
      // Add click handler
      tile.addEventListener('click', function(e) {
        e.stopPropagation();
        cycleTileState(tileId, tile);
      });
      
      grid.appendChild(tile);
    }
  }
}

// Cycle through donation states: available -> promised -> paid -> available
function cycleTileState(tileId, tileElement) {
  const currentState = donationData[tileId];
  let newState;
  
  switch(currentState) {
    case 'available':
      newState = 'promised';
      break;
    case 'promised':
      newState = 'paid';
      break;
    case 'paid':
      newState = 'available';
      break;
    default:
      newState = 'available';
  }
  
  donationData[tileId] = newState;
  tileElement.className = `tile ${newState}`;
  tileElement.title = `Tile ${tileId} - ${newState.charAt(0).toUpperCase() + newState.slice(1)} - Click to change`;
  
  updateDonationStats();
}

// Update donation statistics
function updateDonationStats() {
  const stats = { available: 0, promised: 0, paid: 0 };
  
  Object.values(donationData).forEach(state => {
    stats[state]++;
  });
  
  const hud = document.getElementById('hud');
  const total = stats.available + stats.promised + stats.paid;
  const progress = ((stats.promised + stats.paid) / total * 100).toFixed(1);
  
  hud.innerHTML = `
    <b>Fundraising Progress:</b><br>
    Available: ${stats.available} tiles<br>
    Promised: ${stats.promised} tiles<br>
    Paid: ${stats.paid} tiles<br>
    <b>Progress: ${progress}%</b>
  `;
}

(function(){
  const hud = document.getElementById('hud');
  const grid = document.getElementById('grid');
  const shapes = [...grid.children].filter(el => el.classList.contains('shape')).map(el=>{
    const cs=getComputedStyle(el);
    const [cStart,cSpan]=cs.gridColumn.split('/').map(s=>s.trim());
    const [rStart,rSpan]=cs.gridRow.split('/').map(s=>s.trim());
    return {
      c0:+cStart, cw:+cSpan.replace('span',''),
      r0:+rStart, rh:+rSpan.replace('span','')
    };
  });

  let area=0, okOverlap=true;
  const used=new Set(), key=(c,r)=>`${c},${r}`;
  for(const s of shapes){
    area += s.cw*s.rh;
    for(let c=s.c0; c<s.c0+s.cw; c++){
      for(let r=s.r0; r<s.r0+s.rh; r++){
        const k=key(c,r);
        if(used.has(k)) okOverlap=false; else used.add(k);
      }
    }
  }
  const ok = (area===513 && okOverlap);
  hud.classList.toggle('error', !ok);
  
  // Generate tiles and initialize donation tracking
  generateTiles();
  updateDonationStats();
})();
</script>
</body>
</html>
